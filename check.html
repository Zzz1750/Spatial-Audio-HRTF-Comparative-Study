<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fixed Spatial Audio with Binaural</title>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      background: #000;
    }
    .container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      z-index: 1000;
      pointer-events: none;
    }
    .instructions {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      max-width: 500px;
      margin-bottom: 20px;
    }
    h1 {
      margin-top: 0;
      color: #4cc3d9;
    }
    .debug-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
    }
    .credit {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #aaa;
      font-size: 14px;
    }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 24px;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">Loading audio resources...</div>

  <a-scene>
    <!-- Camera + Cursor -->
    <a-entity id="rig" position="0 0 0">
      <a-entity id="camera" camera position="0 1.6 0" look-controls>
        <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: #4cc3d9; shader: flat">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Background -->
    <a-sky color="#333333"></a-sky>

    <!-- Audio entity - fixed in world space -->
    <a-entity id="fixed-audio"
              sound="src: url(./audio/binaural.wav); 
                     autoplay: false; 
                     loop: true; 
                     positional: false">
    </a-entity>

    <!-- Visual representation of the fixed audio source -->
    <a-entity id="audio-source-visual" position="-3 1.6 -3">
      <a-sphere radius="0.2" color="#4CC3D9" 
                animation="property: position; to: 0 0.3 0; dir: alternate; dur: 1500; loop: true; easing: easeInOutQuad">
      </a-sphere>
      <a-ring radius-outer="0.5" radius-inner="0.4" color="#FFC107" rotation="-90 0 0"></a-ring>
      <a-text value="Audio Source" align="center" position="0 -0.5 0" color="white"></a-text>
    </a-entity>

    <!-- Play/pause button -->
    <a-entity id="play-button" position="0 1.6 -1.5">
      <a-cylinder radius="0.3" height="0.1" color="#333" class="clickable">
        <a-text value="▶ PLAY" align="center" position="0 0 0.06" color="white" width="3"></a-text>
      </a-cylinder>
    </a-entity>

    <!-- Room structure for spatial reference -->
    <a-box position="0 0 -4" width="8" height="4" depth="8" material="color: #777; opacity: 0.1; transparent: true"></a-box>
    <a-box position="-4 0 0" width="0.2" height="4" depth="8" material="color: #AAA; opacity: 0.2; transparent: true"></a-box>
    <a-box position="4 0 0" width="0.2" height="4" depth="8" material="color: #AAA; opacity: 0.2; transparent: true"></a-box>

    <!-- Floor -->
    <a-circle id="floor" position="0 0 0" radius="10" rotation="-90 0 0" material="color: #222; opacity: 0.5; transparent: true"></a-circle>

    <!-- Direction indicators -->
    <a-entity position="0 0.01 0">
      <a-entity rotation="0 0 0">
        <a-text value="N" align="center" position="0 0 -5" color="#FF5252"></a-text>
        <a-line start="0 0 -4.8" end="0 0 -4.5" color="#FF5252"></a-line>
      </a-entity>
      <a-entity rotation="0 90 0">
        <a-text value="E" align="center" position="0 0 -5" color="#4CAF50"></a-text>
        <a-line start="0 0 -4.8" end="0 0 -4.5" color="#4CAF50"></a-line>
      </a-entity>
      <a-entity rotation="0 180 0">
        <a-text value="S" align="center" position="0 0 -5" color="#2196F3"></a-text>
        <a-line start="0 0 -4.8" end="0 0 -4.5" color="#2196F3"></a-line>
      </a-entity>
      <a-entity rotation="0 270 0">
        <a-text value="W" align="center" position="0 0 -5" color="#FFC107"></a-text>
        <a-line start="0 0 -4.8" end="0 0 -4.5" color="#FFC107"></a-line>
      </a-entity>
    </a-entity>
  </a-scene>

  <div class="container">
    <div class="instructions">
      <h1>Fixed Spatial Audio Demo</h1>
      <p>This demo uses your pre-rendered binaural audio fixed in world space.</p>
      <p>Click the PLAY button and then move your head to experience the spatial audio that doesn't follow your rotation.</p>
    </div>
  </div>

  <div class="debug-panel">
    <div>Camera Rotation: <span id="rotation-display">0°</span></div>
    <div>Audio State: <span id="audio-state">Stopped</span></div>
  </div>

  <div class="credit">
    Using your ./audio/binaural.wav file - audio fixed in world space
  </div>

  <script>
    // Wait for A-Frame to load
    window.addEventListener('load', function() {
      const playButton = document.querySelector('#play-button');
      const audioEl = document.querySelector('#fixed-audio');
      const audioState = document.querySelector('#audio-state');
      const rotationDisplay = document.querySelector('#rotation-display');
      const camera = document.querySelector('#camera');
      const loading = document.querySelector('#loading');
      let isPlaying = false;

      // Hide loading when audio is ready
      setTimeout(() => {
        if (loading) loading.style.display = 'none';
      }, 2000);

      // Update debug panel with camera rotation
      setInterval(() => {
        if (camera && camera.object3D) {
          const rotation = camera.getAttribute('rotation');
          rotationDisplay.textContent = `${Math.round(rotation.y)}°`;
        }
      }, 100);

      // Play/pause functionality
      playButton.addEventListener('click', () => {
        if (isPlaying) {
          audioEl.components.sound.stopSound();
          audioState.textContent = 'Stopped';
          playButton.setAttribute('material', 'color', '#333');
          playButton.querySelector('a-text').setAttribute('value', '▶ PLAY');
        } else {
          audioEl.components.sound.playSound();
          audioState.textContent = 'Playing';
          playButton.setAttribute('material', 'color', '#555');
          playButton.querySelector('a-text').setAttribute('value', '❚❚ PAUSE');
        }
        isPlaying = !isPlaying;
      });

      // Add hover effects
      playButton.addEventListener('mouseenter', () => {
        if (!isPlaying) {
          playButton.setAttribute('material', 'color', '#444');
        }
      });

      playButton.addEventListener('mouseleave', () => {
        if (!isPlaying) {
          playButton.setAttribute('material', 'color', '#333');
        }
      });
    });
  </script>
</body>
</html>