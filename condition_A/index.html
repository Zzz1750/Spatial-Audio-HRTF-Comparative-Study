<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Condition A</title>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
</head>
<style>
  body{
    margin: 0;
    background-color: black;
  }

  #enter-vr-btn{
    position:absolute; 
    z-index:9; 
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
    font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
  }
</style>
<body>
   <button id="enter-vr-btn">
    GO VR
  </button>

  <audio id="intro_audio" src="../audio/intro_new.mp3"></audio>

  <a-scene id="scene" vr-mode-ui="enabled: false" xr-mode-ui="enabled: false" visible="false">

    <!-- Camera rig -->
    <a-entity id="camera-rig" position="0 -3 0" rotation="0 90 0">
      <a-camera fov="90">
       <a-cursor
          raycaster="objects: .ray-target"
          fuse="false"
          
          material="opacity: 0; transparent: true">
      </a-cursor>

      </a-camera>


    <!-- Right controller with laser -->
    <a-entity 
      laser-controls="hand: right" 
      raycaster="objects: .clickable" 
      cursor="fuse: false">
    </a-entity>

    <!-- Left controller with laser -->
    <a-entity 
      laser-controls="hand: left" 
      raycaster="objects: .clickable" 
      cursor="fuse: false">
    </a-entity>
      

    <!-- Intro -->
    <a-text id="intro_text" 
      value="Immersive Audio - Comparative Analysis" 
      position="0 3 -5" 
      align="center" 
      width="5"
      color="white"
      visible="false">
    </a-text>

    <a-plane 
      id="wait_logo"
      src="../images/icon/3d_logo.jpg" 
      position="0 2 -3" 
      width="1" 
      height="1"
      rotation="0 0 0"
      visible="false">
    </a-plane>


    <a-text id="intro_text2" 
      value="Start when you are ready " 
      position="0 3.4 -5" 
      align="center" 
      color="white"
      width="3"
      visible="false">
    </a-text>

    <a-entity id="start_scene1" position="0 2.5 -5" visible="false">
      <a-plane 
        id="intro_plane"
        color="white" 
        width="1" 
        height="0.3" 
        opacity="0.8" 
        transparent="true"
        material="shader: flat"
      ></a-plane>

      <a-text
        id="fake_loader" 
        value="" 
        align="center" 
        color="black" 
        position="0 0 0.01" 
        width="3"
      ></a-text>
    </a-entity>


    
  <!-- Left Pillar Plane (target for raycast) -->
    <a-plane id="left_pillar_plane" 
        class="ray-target" 
        color="tomato" 
        width="2" 
        height="12" 
        position="-6.2 5 -4"
        rotation="0 60 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

    <!-- Elephant Plane (target for raycast) -->
    <a-plane id="elephantt_pillar_plane" 
        class="ray-target" 
        color="yellow" 
        width="2" 
        height="2" 
        position="5.5 1.8 -10"
        rotation="0 -30 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

      <!-- Text to display result -->
      <a-text id="pillar_text" 
        value="Pillar Data " 
        position="0 2 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>
      
      <!-- Text to display result -->
      <a-text id="elephant_text" 
        value="Elephant Data" 
        position="2 3 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>
     

    </a-entity>
  

    <!-- Audio Section -->

    <!-- Elephant Audio -->
    <a-entity id="elephant_audio"
      sound="src: url(../audio/audio1.wav); autoplay: false; positional: true;"
      position="-11.48137 -1.3207 -4.07978">
    </a-entity>

    <!-- Pillar Audio -->
    <a-entity id="pillar_audio"
      sound="src: url(../audio/audio2.wav); autoplay: false; positional: true;"
      position="-3.87222 3.53034 5.88735">
    </a-entity>

    
  <!-- Sky -->
  <a-sky radius="20"></a-sky>
  


  <!-- <a-entity rotation="-90 0 0" position="4 1 -1" id="to_scene2"> 
  <a-circle class="clickable" color="white" radius="0.9" 
    material="opacity: 0.6; transparent: true"></a-circle> 
  <a-plane class="clickable" src="../images/arrow_model2.png" 
    width="1" height="1" transparent="true" 
    position="0 0 0.01" 
    material="shader: flat; opacity: 0.8; transparent: true"> 
  </a-plane>  -->
</a-entity>

  </a-scene>
  
  <!-- Enter VR -->
  <script>
    const enter_vr_btn = document.getElementById("enter-vr-btn")
    const scene = document.querySelector("a-scene");
    const intro_audio = document.getElementById('intro_audio');

    enter_vr_btn.addEventListener("click", function () {
    enter_vr_btn.style.display='none';
    intro_audio.play();
    scene.setAttribute('visible','true')
    if (scene) {
      scene.enterVR();
      functions.wait_time_vr();
    }
  });
  </script>


  <script>
    const sky = document.querySelector('a-sky');
    const to_scene2 = document.getElementById('to_scene2');
    const intro_text = document.getElementById('intro_text');
    const intro_text2 = document.getElementById('intro_text2');
    const start_scene1 = document.getElementById('start_scene1');
    const intro_plane = document.getElementById('intro_plane');
    const wait_logo = document.getElementById('wait_logo');

    var intro_ready = 0;

    const functions = {
      wait_time_vr: function () {
        sky.setAttribute('src', '../images/wait_vr.webp');
        wait_logo.setAttribute('visible','true')
        setTimeout(functions.scene1, 9000);
      },
      scene1: function () {
        sky.setAttribute('src', '../images/intro.webp');
        wait_logo.setAttribute('visible','false')

        setTimeout(()=>{
          intro_text.setAttribute('visible','true')
        },1000)

        setTimeout(()=>{
          intro_text2.setAttribute('visible','true')
          start_scene1.setAttribute('visible','true')
          fake_loading_intro();        
        },5000)
      
      /*planes we need */
      intro_plane.classList.add('clickable');

      },
      scene2: function () {
        sky.setAttribute('src', '../images/1.webp');
        intro_text.setAttribute('visible','false')
        intro_text2.setAttribute('visible','false')
        start_scene1.setAttribute('visible','false')

        left_pillar_plane.setAttribute('visible','true')
        elephant_plane.setAttribute('visible','true')
        pillar_text.setAttribute('visible','true')
        elephant_text.setAttribute('visible','true')

        setTimeout(()=>{
          elephant_audio.components.sound.playSound();
        },2000);

        setTimeout(()=>{
          pillar_audio.components.sound.playSound(); 
        },8000);


      }
    };

    start_scene1.addEventListener('click',()=>{
      if(intro_ready == 1){
        document.getElementById('intro_audio').pause();
        functions.scene2();
      }
    })

    
    function fake_loading_intro() {
      const fake_loader = document.getElementById('fake_loader');
      fake_loader.setAttribute('value', 'wait 3s');

      setTimeout(() => {
        fake_loader.setAttribute('value', 'wait 2s');
      }, 2000);

      setTimeout(() => {
        fake_loader.setAttribute('value', 'wait 1s');
      }, 4000);
       
      setTimeout(() => {
        fake_loader.setAttribute('value', 'START');
        intro_ready=1;
      }, 5000);
    }

  </script>

 <script>
  const gazeData = {
    leftPillar: { time: 0 },
    elephant: { time: 0 }
  };

  let startTime = null;

  function gaze_calculator_enter() {
    startTime = Date.now();
  }

  function gaze_calculator_exit(dataObj, property, textEl) {
    if (startTime) {
      const duration = Date.now() - startTime;
      dataObj[property] += duration;
      startTime = null;
      textEl.setAttribute('value', `Time: ${(dataObj[property] / 1000).toFixed(3)}s`);
    }
  }

  const pillar_text = document.getElementById('pillar_text');
  const elephant_text = document.getElementById('elephant_text');

  const left_pillar_plane = document.getElementById('left_pillar_plane');
  const elephant_plane = document.getElementById('elephantt_pillar_plane');

  left_pillar_plane.addEventListener('mouseenter', () => {
    gaze_calculator_enter();
  });
  left_pillar_plane.addEventListener('mouseleave', () => {
    gaze_calculator_exit(gazeData.leftPillar, 'time', pillar_text);
  });

  elephant_plane.addEventListener('mouseenter', () => {
    gaze_calculator_enter();
  });
  elephant_plane.addEventListener('mouseleave', () => {
    gaze_calculator_exit(gazeData.elephant, 'time', elephant_text);
  });
</script>

<script>
  var reaction_time_pillar = 0;
  var reaction_time_pliiar = 0;

  const elephant_audio = document.getElementById('elephant_audio');
  const pillar_audio = document.getElementById('pillar_audio')


</script>

</body>
</html>
