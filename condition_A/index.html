<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Condition A</title>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
</head>
<style>
  body{
    margin: 0;
    background-color: black;
  }

  #name_page{
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 10;
  }
  #enter-vr-btn{
    position:absolute; 
    z-index:12; 
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
  }
  #enter-vr-btn:hover{
    cursor: pointer;
  }
  #name_page_label{
    color: white;
    position: absolute;
    z-index: 13;
    top: 35%;
    left: 50%;
    font-size: 1.2rem;
    transform: translate(-50%,-50%);
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
  }
  #name_page_data{
    color: white;
    position: absolute;
    z-index: 13;
    width: 150px;
    height: 5px;
    top: 40%;
    left: 50%;
    font-size: 1.2rem;
    transform: translate(-50%,-50%);
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    border: 2px solid white;
    border-radius: 10px;
    padding: 15px;
    padding-left: 20px;
    background-color: transparent;
  }
  #main_back_image{
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 11;
    opacity: 0.15;
  }
  #condition_name{
    color: white;
    font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    position: absolute;
    top: 5%;
    left: 16%;
    font-size: 2rem;
    transform: translate(-50%, -50%);
  }
  #instruction_heading{
    color: white;
    position: absolute;
    width: 50%;
    justify-content: center;
    top: 35%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.2rem;
    font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    line-height: 2rem;
  }
  #to_name_page_div2{
    position:absolute; 
    z-index:12; 
    top: 70%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 12px 35px;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
    cursor: pointer;
  }

  #checkbox_sys{
    color: white;
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 15;

  }
  #checkbox_sys input[type="checkbox"] {
      width: 30px;
      height: 12px;
      cursor: pointer;
      accent-color: gold;
      top: 100px;
    }
    #main_welcome_name_page{
      color: white;
      position: absolute;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    #main_welcome_button{
      position:absolute; 
      z-index:12; 
      top: 48%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 35px;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
      cursor: pointer;
    }
</style>

<body>
  <div id="name_page">
    
    <h1 id="condition_name">Condition B - HRTF 1</h1>
    <img src="../images/name_page.webp" id="main_back_image" alt="">

    <div id="name_page_div0" style="display: none;">
      <h1 id="main_welcome_name_page">Welcome to the Research </h1>
      <button id="main_welcome_button">NEXT</button>
    </div>
    
    
    <div id="name_page_div1" style="display:none;">
      <p id="instruction_heading">This condition uses HRTF-1 with head tracking disabled. Please keep your head facing forward <br> <span style="background-color: white; color:black; padding: 0px 5px;">do not explore the content</span>  <br>Focus only on the audio for this Condition.</p>
      <span id="checkbox_sys"><input type="checkbox" id="myCheckbox">I accept the above rules</span>
      <button id="to_name_page_div2" style="display: none;">NEXT</button>
    </div>

     <div id="name_page_div2" style="display: block;">
        <label for="name_page_data" id="name_page_label">Participant ID: </label>
        <input type="text" id="name_page_data" name="name_page_data">
        <button id="enter-vr-btn">Enter VR</button>
    </div>
 </div>

  <audio id="intro_audio" src="../audio/intro_new.mp3"></audio>
  <audio id="main_audio_vr" src="../audio/question3_song.mp3" loop></audio>

  <a-scene id="scene" vr-mode-ui="enabled: false" xr-mode-ui="enabled: false" visible="false">

    <!-- Camera rig -->
    <a-entity id="camera-rig" position="0 -3 0" rotation="0 90 0">
      <a-camera fov="90">
       <a-cursor
          raycaster="objects: .ray-target"
          fuse="false"
          
          material="opacity: 0; transparent: true">
      </a-cursor>

      </a-camera>


    <!-- Right controller with laser -->
    <a-entity 
      laser-controls="hand: right" 
      raycaster="objects: .clickable" 
      cursor="fuse: false">
    </a-entity>

    <!-- Left controller with laser -->
    <a-entity 
      laser-controls="hand: left" 
      raycaster="objects: .clickable" 
      cursor="fuse: false">
    </a-entity>
      

    <!-- Intro -->
    <a-text id="intro_text" 
      value="Immersive Audio - Comparative Analysis" 
      position="0 3 -5" 
      align="center" 
      width="5"
      color="white"
      visible="false">
    </a-text>

    <a-plane 
      id="wait_logo"
      src="../images/icon/3d_logo.jpg" 
      position="0 2 -3" 
      width="1" 
      height="1"
      rotation="0 0 0"
      visible="false">
    </a-plane>

    <a-text id="intro_text2" 
      value="Start when you are ready " 
      position="0 3.4 -5" 
      align="center" 
      color="white"
      width="3"
      visible="false">
    </a-text>

    <a-entity id="start_scene1" position="0 2.5 -5" visible="false">
      <a-plane 
        id="intro_plane"
        color="white" 
        width="1" 
        height="0.3" 
        opacity="0.8" 
        transparent="true"
        material="shader: flat"
        class="clickable"
      ></a-plane>

      <a-text
        id="fake_loader" 
        value="" 
        align="center" 
        color="black" 
        position="0 0 0.01" 
        width="3"
      ></a-text>



    </a-entity>


    
  <!-- Left Pillar Plane (target for raycast) -->
    <a-plane id="left_pillar_plane" 
        class="ray-target" 
        color="yellow" 
        width="0" 
        height="0" 
        position="-6.2 5 -4"
        rotation="0 60 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

    <!-- Elephant Plane (target for raycast) -->
    <a-plane id="elephantt_plane" 
        class="ray-target" 
        color="yellow" 
        width="0" 
        height="0" 
        position="5.5 1.8 -10"
        rotation="0 -30 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>


    <!-- Elephant DUMMY Plane (target for raycast) -->
    <a-plane id="elephant_dummy_plane" 
        class="ray-target" 
        color="red" 
        width="0" 
        height="0" 
        position="-4.5 1.8 -10"
        rotation="0 30 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

     <!-- Left Pillar DUMMY Plane (target for raycast) -->
    <a-plane id="left_pillar_dummy_plane" 
        class="ray-target" 
        color="red" 
        width="0" 
        height="0" 
        position="7 5 -4"
        rotation="0 -60 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

     <!-- Chandlier Plane (target for raycast) -->
    <a-plane id="chandlier_plane" 
        class="ray-target" 
        color="yellow" 
        width="0" 
        height="0" 
        position="0 9 -0.5"
        rotation="90 0 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

    <!-- DUMMY 1 Chandlier Plane (target for raycast) -->
    <a-plane id="chandlier_plane_dummy_1" 
        class="ray-target" 
        color="red" 
        width="0" 
        height="0" 
        position="-13 8.5 0.3" 
        rotation="10 90 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

    

    <!-- DUMMY 2 Chandlier Plane (target for raycast) -->
    <a-plane id="chandlier_plane_dummy_2" 
        class="ray-target" 
        color="red" 
        width="0" 
        height="0" 
        position="12 10.93349 -0.40336" 
        rotation="10 -90 0"
        opacity= '0.8'
        transparent = 'true'
        visible="false">
    </a-plane>

    

    </a-plane>
    <!-- Questionnaire Section -->

    <!-- scene 3 -->
     <a-entity id="question_scene3" position="0 3 -8" visible="false">
      <a-plane
        id="question_scene3_plane"
        color="white" 
        width="0" 
        height="0"></a-plane>
      
      <a-text
        value=" How did the doorway narration sound to you" 
        align="center" 
        color="black"></a-text>
  
     </a-entity>

      <a-entity id="option1_scene3" position="0 2 -8" visible="false" class="clickable">
      <a-plane
        id="option1_scene3_plane"
        color="gray" 
        width="0" 
        height="0" 
        class="clickable"></a-plane>
      
      <a-text
        value="Near" 
        position="-2 0 0" 
        color="white"></a-text>
     </a-entity>


     <a-entity id="option2_scene3" position="0 1.3 -8" visible="false" class="clickable">
      <a-plane
        id="option2_scene3_plane"
        color="gray" 
        width="0" 
        height="0"
        class="clickable"></a-plane>
      
      <a-text
        value="Medium" 
        position="-2 0 0" 
        color="white"></a-text>
     </a-entity>


     <a-entity id="option3_scene3" position="0 0.6 -8" visible="false" class="clickable">
      <a-plane
        id="option3_scene3_plane"
        color="gray" 
        width="0" 
        height="0"
        class="clickable"></a-plane>
      
      <a-text
        value="Far" 
        position="-2 0 0" 
        color="white"></a-text>
     </a-entity>

     

     



    <!-- Debugging Texts Here -->

      <!-- Pillar Text -->
      <a-text id="pillar_text" 
        value="Pillar Data " 
        position="-2 4 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>
      
      <!-- Elephant Text -->
      <a-text id="elephant_text" 
        value="Elephant Data" 
        position="2.478 4.096 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- Elephant Reaction Text -->
      <a-text id="elephant_reaction" 
        value="elephant reaction " 
        position="2.6 3.732 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- Pillar Reaction Text -->
      <a-text id="pillar_reaction" 
        value="Pillar reaction " 
        position="-1.85 3.6 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- Elephant Navigation -->
      <a-text id="elephant_nav_text" 
        value="Elephant Nav:  " 
        position="2.5 3.323 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>
     
      <!-- Pillar Navigation -->
      <a-text id="pillar_nav_text" 
        value="Pillar Nav:  " 
        position="-2 3.2 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- Chandlier Gaze Text -->
      <a-text id="chandlier_gaze_text" 
        value="Chandelier Gaze: " 
        position="-2 3.2 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- Chandlier Reaction Text -->
      <a-text id="chandlier_reaction" 
        value="Chandelier Reaction: " 
        position="-2 2.8 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

      <!-- chandlier navigation text -->
      <a-text id="chandlier_nav_text" 
        value="Chandelier Reaction: " 
        position="-2 2.5 -3" 
        align="center" 
        color="yellow"
        visible="false">
      </a-text>

    </a-entity>
  

    <!-- Audio Section -->

    <!-- Elephant Audio -->
    <a-entity id="elephant_audio"
      sound="src: url(../audio/audio1.wav); autoplay: false; positional: true;"
      position="-11.48137 -1.3207 -4.07978">
    </a-entity>

    <!-- Pillar Audio -->
    <a-entity id="pillar_audio"
      sound="src: url(../audio/audio2.wav); autoplay: false; positional: true;"
      position="-3.87222 3.53034 5.88735">
    </a-entity>

    <!-- Door Audio -->
    <a-entity id="door_audio"
      sound="src: url(../audio/audio3.wav); autoplay: false; positional: true;"
      position="-7 1.691 -0.341">
    </a-entity>

    <!-- Chandlier Audio -->
    <a-entity id="chandlier_audio"
      sound="src: url(../audio/audio4.wav); autoplay: false; positional: true;"
      position="-0.3 5 0">
    </a-entity>

    <!-- last_door Audio -->
    <a-entity id="last_door_audio"
      sound="src: url(../audio/audio5.wav); autoplay: false; positional: true;"
      position="-10.486 0.391 1">
    </a-entity>

  <!-- Sky with Sphere -->
  <a-entity id="sky-sphere" geometry="primitive: sphere; radius: 20" material="shader: flat; side: back" scale="-1 1 1"></a-entity>
  

  <!-- Scene2 Button -->
  <a-entity rotation="0 90 90" position="-10 1 -0.3" id="to_scene2" visible="false"> 
    <a-circle class="clickable" color="white" radius="0" material="opacity: 0.9; transparent: true" id="scene2_circle"></a-circle> 
    <a-plane class="clickable" src="../images/arrow_model2.png" width="0" height="0" transparent="true" position="0 0 0.01" material="opacity: 0.8; shader: flat" id="scene2_Bplane"> </a-plane> 
 </a-entity>

 <!-- scene4 Button -->
  <a-entity rotation="0 90 90" position="-8 0 0.5" id="to_scene5" visible="false"> 
      <a-circle class="clickable" color="white" radius="0" material="opacity: 0.9; transparent: true" id="scene5_circle"></a-circle> 
      <a-plane class="clickable" src="../images/arrow_model2.png" width="0." height="0" transparent="true" position="0 0 0.01" material="opacity: 0.8; shader: flat" id="scene5_Bplane"> </a-plane> 
  </a-entity>


  </a-scene>
  
  <!-- Enter VR -->
  <script>
    const name_page = document.getElementById('name_page')
    const enter_vr_btn = document.getElementById("enter-vr-btn")
    const scene = document.querySelector("a-scene");
    const intro_audio = document.getElementById('intro_audio');

    enter_vr_btn.addEventListener("click", function () {
    var name_page_data = document.getElementById('name_page_data').value;
    if (name_page_data == ''){
      name_page.style.display='none';
      scene.setAttribute('visible','true')
      if (scene) {
        scene.enterVR();
        functions.scene2();
      }
    }
    else{
      alert("Participant ID cannot be Empty!")
    }
    
  });
  </script>

  <!-- common functions -->
   <script>
     const checkbox = document.getElementById("myCheckbox");
     const to_name_page_div2 = document.getElementById('to_name_page_div2');

      checkbox.addEventListener("change", () => {
        if (checkbox.checked) {
          to_name_page_div2.style.display='block';
        } else {
          to_name_page_div2.style.display='none';        
        }
      });

      document.getElementById('main_welcome_button').addEventListener('click',()=>{
        document.getElementById('name_page_div0').style.display='none';
        document.getElementById('name_page_div1').style.display='block'
      });

      document.getElementById('to_name_page_div2').addEventListener('click',()=>{
        document.getElementById('name_page_div1').style.display='none';        
        document.getElementById('name_page_div2').style.display='block'
      })

  
      
   </script>

<!-- Scene Manager -->
  <script>
    const skySphere = document.getElementById('sky-sphere');
    const to_scene2 = document.getElementById('to_scene2');
    const intro_text = document.getElementById('intro_text');
    const intro_text2 = document.getElementById('intro_text2');
    const start_scene1 = document.getElementById('start_scene1');
    const intro_plane = document.getElementById('intro_plane');
    const wait_logo = document.getElementById('wait_logo');

    const question_scene3 = document.getElementById('question_scene3');
    const option1_scene3 = document.getElementById('option1_scene3');
    const option2_scene3 = document.getElementById('option2_scene3');
    const option3_scene3 = document.getElementById('option3_scene3');
    var answer_scene3 ='';


    const question_scene3_plane = document.getElementById('question_scene3_plane');
    const option1_scene3_plane = document.getElementById('option1_scene3_plane');
    const option2_scene3_plane = document.getElementById('option2_scene3_plane');
    const option3_scene3_plane = document.getElementById('option3_scene3_plane');
    

    const elephant_reaction = document.getElementById('elephant_reaction');
    const pillar_reaction = document.getElementById('pillar_reaction');
    const elephant_nav_text = document.getElementById('elephant_nav_text');
    const pillar_nav_text = document.getElementById('pillar_nav_text');
    const chandlier_nav_text = document.getElementById('chandlier_nav_text')

    const chandlier_plane = document.getElementById('chandlier_plane');
    const chandlier_plane_dummy_1 = document.getElementById('chandlier_plane_dummy_1');
    const chandlier_plane_dummy_2 = document.getElementById('chandlier_plane_dummy_2');
    const chandlier_reaction = document.getElementById('chandlier_reaction');


    var reaction_time_elephant = 0;
    var reaction_time_pillar = 0;
    var reaction_time_chandlier = 0;

    var elephant_nav='';
    var pillar_nav='';
    var chandlier_nav = '';

    var intro_ready = 0;

    const functions = {


      wait_time_vr: function () {
        skySphere.setAttribute('material', 'src: ../images/wait_vr.webp; shader: flat; side: back');
        wait_logo.setAttribute('visible','true');
        setTimeout(functions.scene1, 8000);
        intro_audio.play();
      },


      scene1: function () {
        skySphere.setAttribute('material', 'src: ../images/intro.webp; shader: flat; side: back');
        wait_logo.setAttribute('visible','false')

        setTimeout(()=>{
          intro_text.setAttribute('visible','true')
        },2000)

        setTimeout(()=>{
          intro_text2.setAttribute('visible','true')
          start_scene1.setAttribute('visible','true')
          fake_loading_intro();        
        },5000)

      },


      scene2: function () {
        //main_audio_vr.play();

        const scene2_circle = document.getElementById('scene2_circle');
        const scene2_Bplane = document.getElementById('scene2_Bplane');

        //General Sky
        skySphere.setAttribute('material', 'src: ../images/1.webp; shader: flat; side: back');
        
        //prev scene components
        intro_text.setAttribute('visible','false')
        intro_text2.setAttribute('visible','false')
        start_scene1.setAttribute('visible','false')
        intro_plane.setAttribute('width','0')
        intro_plane.setAttribute('height','0')

        //a-plane components
        left_pillar_plane.setAttribute('visible','true')
        elephant_plane.setAttribute('visible','true')
        elephant_dummy_plane.setAttribute('visible','true')
        left_pillar_dummy_plane.setAttribute('visible','true')

        pillar_text.setAttribute('visible','true')
        elephant_text.setAttribute('visible','true')
        elephant_reaction.setAttribute('visible','true')
        pillar_reaction.setAttribute('visible','true')
        elephant_nav_text.setAttribute('visible','true')
        pillar_nav_text.setAttribute('visible','true')

        //change it when new scene comes to avoid invisible data overidding 
        left_pillar_plane.setAttribute('width','2')
        left_pillar_plane.setAttribute('height','12')

        left_pillar_dummy_plane.setAttribute('width','2')
        left_pillar_dummy_plane.setAttribute('height','12')

        elephant_plane.setAttribute('width','2')
        elephant_plane.setAttribute('height','2.5')

        elephant_dummy_plane.setAttribute('width','1.5')
        elephant_dummy_plane.setAttribute('height','2.5')

        scene2_circle.setAttribute('radius','0.5')
        scene2_Bplane.setAttribute('width','0.6')
        scene2_Bplane.setAttribute('height','0.6')

        //audio 1 - ( Elephant System )
        setTimeout(() => {
          elephant_audio.components.sound.playSound();

          check_reaction_time(25000, elephant_plane, (time) => { 
            reaction_time_elephant = time;
            elephant_reaction.setAttribute('value', ` Elephant Reaction: ${reaction_time_elephant}s`);
          });

         check_dummy_wins(elephant_plane, elephant_dummy_plane, 20000).then(result => {
            elephant_nav = result;
            elephant_nav_text.setAttribute('value', `Elephant Nav: ${elephant_nav}`);
          });

        }, 3000); 



        //audio 2 - ( Pillar System )
        setTimeout(() => {
          pillar_audio.components.sound.playSound();

        
          check_reaction_time(17000, left_pillar_plane, (time) => {
            reaction_time_pillar = time;
            pillar_reaction.setAttribute('value', `Pillar Reaction: ${reaction_time_pillar}s`);
          });

          check_dummy_wins(left_pillar_plane, left_pillar_dummy_plane, 15000).then(result => {
            pillar_nav = result;
            pillar_nav_text.setAttribute('value', `Pillar Nav: ${pillar_nav}`);
          });

        }, 26000);


        //audio 3 - ( Front Door )
        setTimeout(()=>{
          door_audio.components.sound.playSound();
          to_scene2.setAttribute('visible','true');
        }, 43000)
      },






    scene3: function(){
      //General Sky
      skySphere.setAttribute('material', 'src: ../images/question1.webp; shader: flat; side: back');

      door_audio.components.sound.pauseSound();

      //prev components
        left_pillar_plane.setAttribute('visible','false')
        elephant_plane.setAttribute('visible','false')
        elephant_dummy_plane.setAttribute('visible','false')
        left_pillar_dummy_plane.setAttribute('visible','false')

        pillar_text.setAttribute('visible','false')
        elephant_text.setAttribute('visible','false')
        elephant_reaction.setAttribute('visible','false')
        pillar_reaction.setAttribute('visible','false')
        elephant_nav_text.setAttribute('visible','false')
        pillar_nav_text.setAttribute('visible','false')

        to_scene2.setAttribute('visible','false');
        scene2_circle.setAttribute('radius','0')
        scene2_Bplane.setAttribute('width','0')
        scene2_Bplane.setAttribute('height','0')

        //change it when new scene comes to avoid invisible data overidding 
        left_pillar_plane.setAttribute('width','0')
        left_pillar_plane.setAttribute('height','0')

        left_pillar_dummy_plane.setAttribute('width','0')
        left_pillar_dummy_plane.setAttribute('height','0')

        elephant_plane.setAttribute('width','0')
        elephant_plane.setAttribute('height','0')

        elephant_dummy_plane.setAttribute('width','0')
        elephant_dummy_plane.setAttribute('height','0')

        

       //a-plane components
       question_scene3.setAttribute('visible','true')
       option1_scene3.setAttribute('visible','true')
       option2_scene3.setAttribute('visible','true')
       option3_scene3.setAttribute('visible','true')

        question_scene3_plane.setAttribute('width','4.8')
        question_scene3_plane.setAttribute('height','0.5')

        option1_scene3_plane.setAttribute('width','4.8')
        option1_scene3_plane.setAttribute('height','0.5')

        option2_scene3_plane.setAttribute('width','4.8')
        option2_scene3_plane.setAttribute('height','0.5')

        option3_scene3_plane.setAttribute('width','4.8')
        option3_scene3_plane.setAttribute('height','0.5')
        

        option1_scene3.addEventListener('mouseenter', () => {
          option1_scene3_plane.setAttribute('color', '#f7b968');
        });

        option1_scene3.addEventListener('mouseleave', () => {
          option1_scene3_plane.setAttribute('color', 'gray');
        });
        
        option2_scene3.addEventListener('mouseenter', () => {
          option2_scene3_plane.setAttribute('color', '#f7b968');
        });

        option2_scene3.addEventListener('mouseleave', () => {
          option2_scene3_plane.setAttribute('color', 'gray');
        });

        option3_scene3.addEventListener('mouseenter', () => {
          option3_scene3_plane.setAttribute('color', '#f7b968');
        });

        option3_scene3.addEventListener('mouseleave', () => {
          option3_scene3_plane.setAttribute('color', 'gray');
        });

        check_scene3_questions();
     },

    scene4: function(){
      //General Sky
      skySphere.setAttribute('material', 'src: ../images/3.webp; shader: flat; side: back');

      const chandlier_audio = document.getElementById('chandlier_audio');
      const last_door_audio = document.getElementById('last_door_audio');

      const to_scene5 = document.getElementById('to_scene5');
      const scene5_circle =document.getElementById('scene5_circle');
      const scene5_Bplane = document.getElementById('scene5_Bplane')

      //prev components
      question_scene3.setAttribute('visible','false')
       option1_scene3.setAttribute('visible','false')
       option2_scene3.setAttribute('visible','false')
       option3_scene3.setAttribute('visible','false')

        question_scene3_plane.setAttribute('width','0')
        question_scene3_plane.setAttribute('height','0')

        option1_scene3_plane.setAttribute('width','0')
        option1_scene3_plane.setAttribute('height','0')

        option2_scene3_plane.setAttribute('width','0')
        option2_scene3_plane.setAttribute('height','0')

        option3_scene3_plane.setAttribute('width','0')
        option3_scene3_plane.setAttribute('height','0')

        //a-plane components
        chandlier_plane.setAttribute('visible','true');
        chandlier_plane_dummy_1.setAttribute('visible','true');
        chandlier_plane_dummy_2.setAttribute('visible','true');

        chandlier_plane.setAttribute('width','5')
        chandlier_plane.setAttribute('height','5')

        chandlier_plane_dummy_1.setAttribute('width','3.5')
        chandlier_plane_dummy_1.setAttribute('height','3.5')

        chandlier_plane_dummy_2.setAttribute('width','3.5')
        chandlier_plane_dummy_2.setAttribute('height','3.5')

        chandlier_gaze_text.setAttribute('visible','true')
        chandlier_reaction.setAttribute('visible','true')
        chandlier_nav_text.setAttribute('visible','true')

        scene5_circle.setAttribute('radius','0.5')
        scene5_Bplane.setAttribute('width','0.6')
        scene5_Bplane.setAttribute('height','0.6')


        //audio 4
        setTimeout(() => {
          chandlier_audio.components.sound.playSound();

          check_reaction_time(22000, chandlier_plane, (time) => {
            reaction_time_chandlier = time;
            chandlier_reaction.setAttribute('value', `Chandlier Reaction: ${reaction_time_chandlier}s`);
          });

          check_dummy_wins_three(chandlier_plane, chandlier_plane_dummy_1, chandlier_plane_dummy_2, 20000)
          .then(result => {
            chandlier_nav = result;
            chandlier_nav_text.setAttribute('value', `Chandelier Reaction: ${chandlier_nav}`);
          });

        }, 2000); 

        //audio 5
        setTimeout(()=>{
          last_door_audio.components.sound.playSound();
          to_scene5.setAttribute('visible', 'true')
        }, 25000)

    }
    };

   



  //intro functions
    start_scene1.addEventListener('click',()=>{
      if(intro_ready == 1){
        document.getElementById('intro_audio').pause();
        functions.scene2();
      }
    })
    
    function fake_loading_intro() {
      const fake_loader = document.getElementById('fake_loader');
      fake_loader.setAttribute('value', 'wait 3s');

      setTimeout(() => {
        fake_loader.setAttribute('value', 'wait 2s');
      }, 2000);

      setTimeout(() => {
        fake_loader.setAttribute('value', 'wait 1s');
      }, 4000);
       
      setTimeout(() => {
        fake_loader.setAttribute('value', 'START');
        intro_ready=1;
      }, 5000);
    }


 

  function check_scene3_questions(){
    option1_scene3.addEventListener('click',()=>{
      answer_scene3 = 'Near'
      to_scene4();
    })

    option2_scene3.addEventListener('click',()=>{
      answer_scene3 = 'Medium'
      to_scene4();
    })

    option3_scene3.addEventListener('click',()=>{
      answer_scene3 = 'Far'
      to_scene4();
    })
  }


  //scene controler
   to_scene2.addEventListener('click',()=>{
    functions.scene3();
  })

   function to_scene4(){
    functions.scene4();
   }


  </script>


<!-- Gaze Calculator -->
 <script>
  const gazeData = {
    leftPillar: { time: 0 },
    elephant: { time: 0 },
    chandlier: { time: 0 }
  };

  let startTime = null;

  function gaze_calculator_enter() {
    startTime = Date.now();
  }

  function gaze_calculator_exit(dataObj, property, textEl) {
    if (startTime) {
      const duration = Date.now() - startTime;
      dataObj[property] += duration;
      startTime = null;
      textEl.setAttribute('value', `Time: ${(dataObj[property] / 1000).toFixed(3)}s`);
    }
  }

  const pillar_text = document.getElementById('pillar_text');
  const elephant_text = document.getElementById('elephant_text');
  const chandlier_gaze_text = document.getElementById('chandlier_gaze_text');

  const left_pillar_plane = document.getElementById('left_pillar_plane');
  const elephant_plane = document.getElementById('elephantt_plane');

  left_pillar_plane.addEventListener('mouseenter', () => {
    gaze_calculator_enter();
  });
  left_pillar_plane.addEventListener('mouseleave', () => {
    gaze_calculator_exit(gazeData.leftPillar, 'time', pillar_text);
  });

  elephant_plane.addEventListener('mouseenter', () => {
    gaze_calculator_enter();
  });
  elephant_plane.addEventListener('mouseleave', () => {
    gaze_calculator_exit(gazeData.elephant, 'time', elephant_text);
  });

  chandlier_plane.addEventListener('mouseenter', ()=> {
    gaze_calculator_enter();
  });

  chandlier_plane.addEventListener('mouseleave', ()=>{
    gaze_calculator_exit(gazeData.chandlier, 'time', chandlier_gaze_text);
  })
</script>


<!-- Reaction Time Calculator -->
<script>
  const elephant_audio = document.getElementById('elephant_audio');
  const pillar_audio = document.getElementById('pillar_audio')
  const door_audio = document.getElementById('door_audio')

  function check_reaction_time(spc_time, planeEl, callback) {
    let reaction_object = 0;
    let reacted = false;

    let reaction_watch = setInterval(() => {
      reaction_object++;
    }, 1000);

    planeEl.addEventListener('mouseenter', () => {
      if (!reacted) {
        reacted = true;
        clearInterval(reaction_watch);
        callback(reaction_object);
      }
    });

    setTimeout(() => {
      if (!reacted) {
        reacted = true;
        clearInterval(reaction_watch);
        callback('NULL');
      }
    }, spc_time);
  }


</script>


<!-- dummy or not -->
<script>
  const elephant_dummy_plane = document.getElementById('elephant_dummy_plane');
  const left_pillar_dummy_plane = document.getElementById('left_pillar_dummy_plane');
  
  function check_dummy_wins(target_plane, dummy_plane, dummy_time) {
  return new Promise((resolve) => {
    let finished = false;

    function handleHover(buttonType) {
      if (!finished) {
        finished = true;
        if (buttonType === 'target') {
          resolve('Success'); 
        } else {
          resolve('Fail'); 
        }
      }
    }

    // Attach once-only listeners
    target_plane.addEventListener('mouseenter', () => handleHover('target'), { once: true });
    dummy_plane.addEventListener('mouseenter', () => handleHover('dummy'), { once: true });

    // If nothing looked at in given time → auto "Failed to Look"
    setTimeout(() => {
      if (!finished) {
        finished = true;
        resolve('Failed to Look');
      }
    }, dummy_time);
  });
}

</script>

<!-- dummy or not but for 3 -->
 <script>
  function check_dummy_wins_three(target_plane, dummy1_plane, dummy2_plane, dummy_time) {
    return new Promise((resolve) => {
      let finished = false;

      function handleHover(buttonType) {
        if (!finished) {
          finished = true;
          if (buttonType === 'target') {
            resolve('Success');
          } else {
            resolve('Fail');
          }
        }
      }

      // Attach once-only listeners
      target_plane.addEventListener('mouseenter', () => handleHover('target'), { once: true });
      dummy1_plane.addEventListener('mouseenter', () => handleHover('dummy1'), { once: true });
      dummy2_plane.addEventListener('mouseenter', () => handleHover('dummy2'), { once: true });

      // If nothing looked at in given time → auto "Failed to Look"
      setTimeout(() => {
        if (!finished) {
          finished = true;
          resolve('Failed to Look');
        }
      }, dummy_time);
    });
  }
</script>

</body>
</html>