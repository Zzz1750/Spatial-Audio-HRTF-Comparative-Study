<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Experience with FOV Controls</title>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
    }
    #ui-overlay {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 15px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
      max-width: 300px;
    }
    #ui-overlay h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .slider-container {
      margin: 10px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input[type="range"] {
      width: 100%;
    }
    .value-display {
      text-align: center;
      font-size: 14px;
      margin-top: 5px;
    }
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }
    button:hover {
      background: #3367d6;
    }
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      border-radius: 8px;
      z-index: 9999;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <a-scene scale="0.2 0.2 0.2" vr-mode-ui="enabled: true">

    <!-- Camera rig with adjustable FOV -->
    <a-entity id="camera-rig" position="0 1.6 0" rotation="0 -120 0">
      <a-camera id="main-camera" fov="90">
        <a-cursor 
          raycaster="objects: .ray-target" 
          fuse="false" 
          material="opacity: 0; transparent: true">
        </a-cursor>
      </a-camera>

      <!-- Right controller with laser -->
      <a-entity 
        laser-controls="hand: right" 
        raycaster="objects: .clickable" 
        cursor="fuse: false">
      </a-entity>

      <!-- Left controller with laser -->
      <a-entity 
        laser-controls="hand: left" 
        raycaster="objects: .clickable" 
        cursor="fuse: false">
      </a-entity>
      
      <!-- Plane (target for raycast) -->
      <a-plane id="left_pillar_plane" 
          class="ray-target" 
          color="tomato" 
          width="2" 
          height="2" 
          position="0 1 -3">
      </a-plane>

      <!-- Text to display result -->
      <a-text id="resultText" 
        value="Look at the plane" 
        position="0 2 -3" 
        align="center" 
        color="yellow">
      </a-text>
    </a-entity>

    <!-- Navigation element -->
    <a-entity rotation="-90 0 0" position="4 1 -1" id="to_scene2"> 
      <a-circle class="clickable" color="white" radius="0.9" 
        material="opacity: 0.6; transparent: true"></a-circle> 
      <a-plane class="clickable" src="../images/arrow_model2.png" 
        width="1" height="1" transparent="true" 
        position="0 0 0.01" 
        material="shader: flat; opacity: 0.8; transparent: true"> 
      </a-plane> 
    </a-entity>

    <!-- Sky -->
    <a-sky radius="20" id="sky"></a-sky>
    
    <!-- Ground -->
    <a-circle id="ground" position="0 0 0" rotation="-90 0 0" radius="20" color="#7BC8A4"></a-circle>
    
    <!-- Reference objects for scale -->
    <a-box position="-2 0.5 -3" color="#4CC3D9" depth="0.5" height="1" width="0.5" class="scale-reference"></a-box>
    <a-cylinder position="2 1 -3" color="#FFC65D" radius="0.5" height="2" class="scale-reference"></a-cylinder>
    <a-sphere position="0 0.5 -5" color="#EF2D5E" radius="0.5" class="scale-reference"></a-sphere>
  </a-scene>

  <!-- UI Controls Overlay -->
  <div id="ui-overlay">
    <h2>VR FOV & Scale Controls</h2>
    
    <div class="slider-container">
      <label for="fov-slider">Field of View (FOV):</label>
      <input type="range" id="fov-slider" min="60" max="120" value="90" step="1">
      <div class="value-display"><span id="fov-value">90</span> degrees</div>
    </div>
    
    <div class="slider-container">
      <label for="scale-slider">World Scale:</label>
      <input type="range" id="scale-slider" min="0.1" max="0.5" value="0.2" step="0.01">
      <div class="value-display"><span id="scale-value">0.2</span></div>
    </div>
    
    <button id="reset-button">Reset to Default</button>
    <button id="toggle-ui">Hide Controls</button>
  </div>

  <div id="instructions">
    <p>Adjust FOV and scale sliders to fix perspective issues. Use controllers to interact.</p>
  </div>

  <script>
    // Scene management functions
    const sky = document.querySelector('a-sky');
    const to_scene2 = document.getElementById('to_scene2');
    const scene = document.querySelector('a-scene');

    const functions = {
      scene1: function () {
        sky.setAttribute('src', 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg');
      },
      scene2: function () {
        sky.setAttribute('src', 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/oldport.jpg');
      }
    };

    // Default to scene 1
    functions.scene1();

    to_scene2.addEventListener('click', () => {
      functions.scene2();
    });

    // Raycasting interaction
    const left_pillar_plane = document.getElementById('left_pillar_plane');
    const text = document.getElementById('resultText');

    left_pillar_plane.addEventListener('mouseenter', () => {
      text.setAttribute('value', 'âœ… Ray hit the plane!');
    });

    left_pillar_plane.addEventListener('mouseleave', () => {
      text.setAttribute('value', 'Look at the plane');
    });

    // FOV and Scale adjustment logic
    const fovSlider = document.getElementById('fov-slider');
    const fovValue = document.getElementById('fov-value');
    const scaleSlider = document.getElementById('scale-slider');
    const scaleValue = document.getElementById('scale-value');
    const resetButton = document.getElementById('reset-button');
    const toggleUiButton = document.getElementById('toggle-ui');
    const uiOverlay = document.getElementById('ui-overlay');
    const camera = document.getElementById('main-camera');
    
    // Update FOV
    fovSlider.addEventListener('input', function() {
      const fov = this.value;
      fovValue.textContent = fov;
      camera.setAttribute('fov', fov);
    });
    
    // Update scale
    scaleSlider.addEventListener('input', function() {
      const scale = this.value;
      scaleValue.textContent = scale;
      scene.setAttribute('scale', `${scale} ${scale} ${scale}`);
    });
    
    // Reset to default values
    resetButton.addEventListener('click', function() {
      fovSlider.value = 90;
      fovValue.textContent = '90';
      camera.setAttribute('fov', 90);
      
      scaleSlider.value = 0.2;
      scaleValue.textContent = '0.2';
      scene.setAttribute('scale', '0.2 0.2 0.2');
    });
    
    // Toggle UI visibility
    let uiVisible = true;
    toggleUiButton.addEventListener('click', function() {
      uiVisible = !uiVisible;
      uiOverlay.style.display = uiVisible ? 'block' : 'none';
      toggleUiButton.textContent = uiVisible ? 'Hide Controls' : 'Show Controls';
    });
  </script>
</body>
</html>